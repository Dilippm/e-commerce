<%- include('../layout/user/header') %>
    <%- include('../layout/user/navbar') %>

        <!-- Menu Toogle -->
        <div class="menu-toggle">
            <a href="#">
                <i class="fa fa-bars"></i>
                <span>Menu</span>
            </a>
        </div>
        <!-- /Menu Toogle -->
    </div>
</div>
<!-- /ACCOUNT -->
</div>
<!-- row -->
</div>
<!-- container -->
</div>
<!-- /MAIN HEADER -->
</header>
<!-- /HEADER -->

<!-- NAVIGATION -->
<nav id="navigation">
<!-- container -->
<div class="container">
<!-- responsive-nav -->
<div id="responsive-nav">
<!-- NAV -->
<ul class="main-nav nav navbar-nav">
<li class="active">
    <a href="/">Home</a>
</li>

</ul>
<!-- /NAV -->
</div>
<!-- /responsive-nav -->
</div>
<!-- /container -->
</nav>
<!-- /NAVIGATION -->

<section id="cart">
<div class="container" style="display: flex; justify-content: center;"></div>

<div class="container-fluid">
<div class="pagetitle" style="margin-top: 70px;">
<!-- <h1><b>Cart</b> </h1> -->
</div>
<table class="table" id="categorytable">
<thead>
<tr>
    <th class="column-1" style="font-size: large;">Product Name</th>
    <th class="column-2" style="font-size: large;">Product Image</th>
    <th class="column-3" style="font-size: large;">Price</th>
    <th class="column-4" style="font-size: large;">Quantity</th>
    <th class="column-5" style="font-size: large;">Total</th>
    <th class="column-6" style="font-size: large;">Remove</th>
</tr>
</thead>
<tbody>

<% cartData.cart.forEach((element) => { %>
    <input
        type="hidden"
        class="<%= element.product._id %>"
        value="<%= element.product.quantity %>">
    <tr class="table_row">
        <td class="column-3">
            <b><%= element.product.productName %></b>
        </td>
        <td class="column-1">
            <div class="how-itemcart1">
                <a
                    href="/productview/<%= element.product._id %>"
                    class="nk-image-box-1 nk-post-image">
                    <img
                        src="/productImages/<%= element.product.images[0] %>"
                        width="100px"
                        height="100px"
                        alt="IMG">
                </a>
            </div>
        </td>
        <td class="column-3">
            <b>â‚¹<%= element.product.price %></b>
        </td>
        <td class="column-4">

            <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
                <div class="form-outline">
                    <button
                        class="cart-item-count ml-3"
                        onclick="changeQuantity('<%= element.product._id %>', -1, '<%= element.productTotalPrice %>')">
                        -
                    </button>
                    <span id="<%= element.product._id %>">
                        <%= element.quantity %>
                    </span>
                    <button
                        class="cart-item-count ml-3"
                        onclick="changeQuantity('<%= element.product._id %>', 1, '<%= element.productTotalPrice %>')">+</button>

                </div>
            </div>
        </td>
        <td class="column-3">
            <strong>Total:
                <span class="<%= element.product._id %>">
                    <%= element.productTotalPrice %>
                </span>
            </strong>
        </td>
        <td class="nk-product-cart-remove">
            <button
                onclick="validate('<%= element.product._id %>')"
                type="button"
                class="btn btn-danger btn-sm mb-2"
                data-mdb-toggle="tooltip"
                title="Move to the wish list">
                <i class="fa fa-trash"></i>
            </button>
        </td>
    </tr>
    <% }); %>

    </tbody>
</table>
<div class="col-md-10 mx-auto ">
    <div class="card mb-10">
        <div class="card-header py-">
            <h5 class="mb-0">Summary</h5>
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">

                <li
                    class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                    <div>
                        <strong style="font-size: larger;">Total amount</strong>
                        <strong>
                            <p class="mb-0" style="font-size: smaller;">(including GST)</p>
                        </strong>
                    </div>
                    <% if(typeof userdetails!=='undefined'){ %>
                        <span id="total">
                            <strong style="font-size: larger;">
                                <%=userdetails.totalPrice %></strong>
                        </span>
                    <%}%>
                </li>
            </ul>

            <button
                type="button"
                style="width: 200px; margin-bottom: 20px;"
                class="btn btn-warning btn-lg btn-block">
                <a style="color: black;" href="/checkout">
                    Go to checkout</a>
            </button>
        </div>
    </div>
</div>

</section>
<!-- FOOTER -->
<footer id="footer">
<!-- top footer -->
<div class="section">
    <!-- container -->
    <div class="container-fluid" style="margin: 0;">
        <!-- row -->
        <div class="row">
            <div class="col-md-3 col-xs-6">
                <div class="footer">
                    <h3 class="footer-title">About Us</h3>
                    <p>We sell the best!!!</p>
                    <ul class="footer-links">
                        <li>
                            <a href="#">
                                <i class="fa fa-map-marker"></i>Kakkanchery, Malappuram</a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-phone"></i>9990009900</a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-envelope-o"></i>electro@gmail.com</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-md-3 col-xs-6">
                <div class="footer">
                    <h3 class="footer-title">Categories</h3>
                    <ul class="footer-links">

                        <li>
                            <a href="/products">Laptops</a>
                        </li>
                        <li>
                            <a href="/products">Smartphones</a>
                        </li>

                    </ul>
                </div>
            </div>

            <div class="clearfix visible-xs"></div>

            <div class="col-md-3 col-xs-6">
                <div class="footer">
                    <h3 class="footer-title">Information</h3>
                    <ul class="footer-links">
                        <li>
                            <a href="#">About Us</a>
                        </li>
                        <li>
                            <a href="#">Contact Us</a>
                        </li>
                        <li>
                            <a href="#">Privacy Policy</a>
                        </li>
                        <li>
                            <a href="/orderlist">Orders and Returns</a>
                        </li>
                        <li>
                            <a href="#">Terms & Conditions</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-md-3 col-xs-6">
                <div class="footer">
                    <h3 class="footer-title">Service</h3>
                    <ul class="footer-links">
                        <li>
                            <a href="/profile">My Account</a>
                        </li>
                        <li>
                            <a href="/cart">View Cart</a>
                        </li>
                        <li>
                            <a href="/wishlist">Wishlist</a>
                        </li>
                        <li>
                            <a href="/orderlist">Track My Order</a>
                        </li>

                    </ul>
                </div>
            </div>
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /top footer -->

</footer>
<!-- /FOOTER -->

<script>

function changeQuantity(proId, count, ptotal) {
    let quantity = parseInt(document.getElementById(proId).innerHTML)
    count = parseInt(count)
    let stock = parseInt(document.getElementsByClassName(proId)[0].value)

    if (quantity <= 1 && count == -1) {} else if (stock == quantity && count == 1) {} else {

        $.ajax({

            url: '/change-Product-Quantity',
            data: {
                product: proId,
                count: count,
                ptotal: ptotal
            },
            method: "post",
            success: (response) => {
                console.log(response);
                document
                    .getElementById(proId)
                    .innerHTML = quantity + count
                document
                    .getElementsByClassName(proId)[1]
                    .innerHTML = response
                    .productprice
                    document
                    .getElementById('total')
                    .innerHTML = response.cartTotal
            }
        })
    }
}
</script>
<script>
function validate(deleteId) {
    Swal
        .fire({
            title: 'Are you sure?',
            text: "You wan't to remove from Cart!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'yes,remove!'
        })
        .then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/deletecart/' + deleteId,
                    method: 'get',
                    success: (response) => {
                        if (response.done) {
                            Swal.fire(
                                {title: 'Removed!', text: 'Successfully removed ', icon: 'success', showConfirmButton: false}
                            )
                            $('#cart').load('/cart #cart')

                        } else if (response.logout) {
                            location.href = '/login'
                        }
                    }
                })
            }
        })
}
</script>

<%- include('../layout/user/footer') %>